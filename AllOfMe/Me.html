<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<title></title>
	<style type="text/css">
		html, body {
			width: 100%;
			height: 100%;
			margin: 0;
		}

		body {
			background-color: #b9b9b9;
		}

		#mainButton {
		}
	</style>
</head>
<body>
	<script src="god.js"></script>
	<svg xmlns="http://www.w3.org/2000/svg" width="88" height="88" id="mainButton" style="position:fixed; display: none;">
		<circle cx="44" cy="44" r="44" fill="red"></circle>
	</svg>
	<script type="text/javascript">
		function getOpacity(width, height, fx, fy, dx, dy) {
			if (dx < 0 || dy < 0 || dx > width || dy > height) {
				return 0;
			}
			function getK(x, y, xx, yy) {
				return (yy - y) / (xx - x);
			}
			var k = getK(dx, dy, fx, fy);
			var kk = getK(0, 0, fx, fx);
			var kkk = getK(width, 0, fx, fy);
			var kkkk = getK(width, height, fx, fy);
			var kkkkk = getK(0, height, fx, fy);
			if ((k > kk || k < kkk) && dy < fy) {
				return Math.abs(dy / fy);
			}
			if (k > kkk && k < kkkk && dx > fx) {
				return Math.abs((width - dx) / (width - fx));
			}
			if ((k > kkkk || k < kkkkk) && dy > fy) {
				return Math.abs((height - dy) / (height - fy));
			}
			return Math.abs(dx / fx);
		}
		var mo = god.window.dragable(mainButton, document.body, true);
		mo.onstart = function (e) {
			var s = getComputedStyle(this.element);
			this.element.style.left = e.pageX - parseFloat(s.width) / 2 + "px";
			this.element.style.top = e.pageY - parseFloat(s.height) / 2 + "px";
		}
		var circle = mainButton.getElementsByTagNameNS("http://www.w3.org/2000/svg", "circle")[0],
			w = circle.r.baseVal.value;
		mo.onmove = function (x, y, nx, ny) {
			circle.style.opacity = getOpacity(document.body.clientWidth - w * 2, document.body.clientHeight - w * 2, x, y, nx, ny);
		};
		mo.onrelease = mo.onset = function () {
			this.element.style.display = "none";
			circle.style.opacity = 1;
		};
		onkeydown = e =>mo.toggle(e.keyCode === 13);
		god.window.setCenter(mainButton, 1);
	</script>
</body>
</html>
